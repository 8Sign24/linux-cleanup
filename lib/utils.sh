#!/bin/bash
#==============================================================================
# 公共函数库
#==============================================================================

# 颜色定义
export RED='\033[0;31m'
export GREEN='\033[0;32m'
export YELLOW='\033[1;33m'
export BLUE='\033[0;34m'
export CYAN='\033[0;36m'
export NC='\033[0m' # No Color
export BOLD='\033[1m'

# 全局变量
TOTAL_FREED=0

#------------------------------------------------------------------------------
# 打印 banner
#------------------------------------------------------------------------------
print_banner() {
    echo -e "${CYAN}========================================${NC}"
    echo -e "${CYAN}     Linux Cleanup Tool v1.0          ${NC}"
    echo -e "${CYAN}========================================${NC}"
    echo ""
}

#------------------------------------------------------------------------------
# 打印标题
#------------------------------------------------------------------------------
print_header() {
    local title="$1"
    echo -e "${BOLD}${BLUE}[$title]${NC}"
}

#------------------------------------------------------------------------------
# 打印成功
#------------------------------------------------------------------------------
print_success() {
    echo -e "${GREEN}✓ $1${NC}"
}

#------------------------------------------------------------------------------
# 打印警告
#------------------------------------------------------------------------------
print_warning() {
    echo -e "${YELLOW}⚠ $1${NC}"
}

#------------------------------------------------------------------------------
# 打印错误
#------------------------------------------------------------------------------
print_error() {
    echo -e "${RED}✗ $1${NC}"
}

#------------------------------------------------------------------------------
# 打印信息
#------------------------------------------------------------------------------
print_info() {
    echo -e "${BLUE}ℹ $1${NC}"
}

#------------------------------------------------------------------------------
# 打印总计
#------------------------------------------------------------------------------
print_total() {
    echo -e "\n${GREEN}累计释放空间: $(format_size $TOTAL_FREED)${NC}"
}

#------------------------------------------------------------------------------
# 格式化大小
#------------------------------------------------------------------------------
format_size() {
    local size=$1
    if [[ $size -ge 1073741824 ]]; then
        echo "$(echo "scale=2; $size/1073741824" | bc)GB"
    elif [[ $size -ge 1048576 ]]; then
        echo "$(echo "scale=2; $size/1048576" | bc)MB"
    elif [[ $size -ge 1024 ]]; then
        echo "$(echo "scale=2; $size/1024" | bc)KB"
    else
        echo "${size}B"
    fi
}

#------------------------------------------------------------------------------
# 获取目录大小
#------------------------------------------------------------------------------
get_dir_size() {
    local dir="$1"
    if [[ -d "$dir" ]]; then
        du -sb "$dir" 2>/dev/null | cut -f1 || echo 0
    else
        echo 0
    fi
}

#------------------------------------------------------------------------------
# 询问确认
#------------------------------------------------------------------------------
ask_confirm() {
    local prompt="$1"
    local default="${2:-n}"
    
    if [[ "$MODE" == "silent" ]]; then
        return 0
    fi
    
    if [[ "$MODE" == "preview" ]]; then
        return 1
    fi
    
    local yn
    if [[ "$default" == "y" ]]; then
        read -p "$prompt [Y/n]: " yn
        [[ -z "$yn" ]] && yn="y"
    else
        read -p "$prompt [y/N]: " yn
        [[ -z "$yn" ]] && yn="n"
    fi
    
    [[ "$yn" =~ ^[Yy]$ ]]
}

#------------------------------------------------------------------------------
# 打印汇总
#------------------------------------------------------------------------------
print_summary() {
    print_total
    echo ""
    print_success "清理完成!"
}
